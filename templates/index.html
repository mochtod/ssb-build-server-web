{% extends "base.html" %}

{% block title %}Create VM - RHEL9 VM Provisioning{% endblock %}

{% block content %}

            <div class="card">
                <h2>Create New Virtual Machine</h2>
                <form action="{{ url_for('submit') }}" method="post">
                    <div class="form-section">
                        <h3>VM Identification</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="server_prefix">Server Environment:</label>
                                <select id="server_prefix" name="server_prefix" required>
                                    <option value="">Select environment</option>
                                    <optgroup label="Non-Production">
                                        {% for prefix in environments.nonprod %}
                                            <option value="{{ prefix }}">{{ prefix }} ({{ server_prefixes[prefix] }})</option>
                                        {% endfor %}
                                    </optgroup>
                                    <optgroup label="Production">
                                        {% for prefix in environments.prod %}
                                            <option value="{{ prefix }}">{{ prefix }} ({{ server_prefixes[prefix] }})</option>
                                        {% endfor %}
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="app_name">Application Name (3-5 chars):</label>
                                <input type="text" id="app_name" name="app_name" maxlength="5" minlength="3" required>
                                <small>Example: web, app, db, ssbs</small>
                            </div>
                        </div>
                        <p class="preview">Preview: <span id="name_preview">lin2xx-app-10001</span></p>
                    </div>                    <div class="form-section">
                        <h3>vSphere Location</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vsphere_datacenter">Datacenter:</label>
                                <select id="vsphere_datacenter" name="vsphere_datacenter" required>
                                    <option value="">Select Datacenter...</option>
                                    {% if vsphere_data.datacenters %}
                                        {% for dc in vsphere_data.datacenters %}
                                        <option value="{{ dc }}">{{ dc }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="" disabled>Could not load datacenters</option>
                                    {% endif %}
                                </select>
                                <small>First select a datacenter to see available resource pools</small>
                            </div>
                            <div class="form-group">
                                <label for="vsphere_resource_pool">Resource Pool/Cluster:</label>
                                <select id="vsphere_resource_pool" name="vsphere_resource_pool" required disabled>
                                    <option value="">Select Resource Pool...</option>
                                </select>
                                <small>Available resource pools will load based on datacenter selection</small>
                            </div>
                        </div>                        <div class="form-row">
                            <div class="form-group">
                                <label for="vsphere_datastore">Datastore:</label>
                                <select id="vsphere_datastore" name="vsphere_datastore" required disabled>
                                    <option value="">Select Datastore...</option>
                                </select>
                                <small>Available datastores will load based on resource pool selection</small>
                            </div>
                            <div class="form-group">
                                <label for="vsphere_template">VM Template:</label>
                                <select id="vsphere_template" name="vsphere_template" required disabled>
                                    <option value="">Select Template...</option>
                                </select>
                                <small>Available templates will load based on resource pool selection</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vsphere_network">Network:</label>
                                <select id="vsphere_network" name="vsphere_network" required disabled>
                                    <option value="">Select Network...</option>
                                </select>
                                <small>Available networks will load based on resource pool selection</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>VM Specifications</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quantity">Number of VMs:</label>
                                <input type="number" id="quantity" name="quantity" min="1" max="10" value="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="num_cpus">CPU Cores:</label>
                                <select id="num_cpus" name="num_cpus">
                                    <option value="1">1 Core</option>
                                    <option value="2" selected>2 Cores</option>
                                    <option value="4">4 Cores</option>
                                    <option value="8">8 Cores</option>
                                    <option value="16">16 Cores</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="memory">Memory (MB):</label>
                                <select id="memory" name="memory">
                                    <option value="2048">2 GB</option>
                                    <option value="4096" selected>4 GB</option>
                                    <option value="8192">8 GB</option>
                                    <option value="16384">16 GB</option>
                                    <option value="32768">32 GB</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Storage Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="disk_size">Primary Disk (GB):</label>
                                <select id="disk_size" name="disk_size">
                                    <option value="20">20 GB</option>
                                    <option value="50" selected>50 GB</option>
                                    <option value="100">100 GB</option>
                                    <option value="200">200 GB</option>
                                    <option value="500">500 GB</option>
                                </select>
                            </div>
                        </div>

                        <div id="additional_disks">
                            <h4>Additional Disks <button type="button" id="add_disk" class="btn-small">Add Disk</button></h4>
                            <div class="disk-list"></div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Network Configuration (IP via Netbox)</h3>
                        <div class="form-row">
                            <div class="form-group">                                <label for="netbox_ip_range">IP Range:</label>
                                <select id="netbox_ip_range" name="netbox_ip_range" class="searchable-select" required>
                                    <option value="">Select IP Range...</option>
                                    {% if netbox_ranges %}
                                        {% for range in netbox_ranges %}
                                        <option value="{{ range.prefix }}">{{ range.name }} ({{ range.prefix }})</option>
                                        {% endfor %}
                                    {% else %}
                                        <option value="" disabled>Could not load IP ranges</option>
                                    {% endif %}
                                </select>
                                <small>The next available IP will be fetched from this range.</small>
                            </div>
                            <!-- Add network selection if needed, currently using environment default -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>User Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="build_owner">Your Name:</label>
                                <input type="text" id="build_owner" name="build_owner" value="{{ user_name }}" readonly>
                                <small>This name will be associated with the VM configuration</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Create VM Configuration</button>
                        <button type="reset" class="btn">Reset</button>
                    </div>
                </form>
            </div>
{% endblock %}
